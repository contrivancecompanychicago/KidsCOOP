{% extends "global/Page.html" %}
{% load staticfiles otree_tags %}

{% block styles %}
<style>
.otree-btn-next {
    all: initial;
    background-image: url({% static 'public_good_kids/confirm.png' %});
    background-repeat: no-repeat;
    background-position: center;
    background-size: 100%;
    border: 0px;
    width: 100px;
    height: 100px;
}

.hidden {
    visiblity: hidden;
}

#timer {
  width: 800px;
  height: 25px;
  background-color: white;
}

#timeleft {
  width: 100%;
  height: 100%;
  background-color: green;
  transition: width 0.3s linear;
}

#container {
  /* gesamte Spielfläche */
  width: 800px;
  height: 800px;
  position: relative;
  border: solid black;
}

.partner {
  /* Geldtöpfe */
  border-radius: 15%;
  width: 20%;
  height: 20%;
  position: absolute;
  z-index: -2;
}

#partnerLeft {
  /* Geldtopf links */
  background-color: rgb(255,255,1);
  top: 40%;
  left: 2.5%;
}

#partnerTop {
  /* Geldtopf oben */
  background-color: rgb(98,190,1);
  top: 2.5%;
  left: 40%;
}

#partnerRight {
  /* Geldtopf rechts */
  background-color: rgb(192,0,0);
  top: 40%;
  right: 2.5%;
}

#partnerBottom {
  /* Geldtopf unten */
  left: 40%;
  bottom: 2.5%;
  background-color: rgb(104,132,195);
}

#mainpot {
  /* Gemeinschaftseldtopf in der Mitte */
  border-radius: 15%;
  width: 30%;
  height: 30%;
  left: 35%;
  top: 35%;
  position: absolute;
  background-image: url({% static 'public_good_kids/main.png' %});
  background-position: center;
}

.figure {
  /* Spielerfiguren neben den Töpfen */
  height: 10%;
  position: absolute;
  z-index: 2;
}

.figureLeft {
  top: 35%;
  left: 23%;
}

.figureTop {
  top: 22%;
  left: 59%;
}

.figureRight {
  top: 55%;
  left: 71%;
}

.figureBottom {
  top: 68%;
  left: 35%;
}

.animal {
  /* Tierfiguren neben den Spielfiguren */
  width: 8%;
  position: absolute;
  z-index: 1;
}

.animalLeft {
  top: 34%;
  left: 15%;
}

.animalTop {
  top: 16%;
  left: 61%;
}

.animalRight {
  top: 61%;
  left: 78%;
}

.animalBottom {
  top: 80%;
  left: 31%;
}

.coins {
  width: 4%;
  position: absolute;
  transition: all 1.5s;
}

#cl1 {
  top: 41%;
  left: 27%;
}

#cl2 {
  top: 44.5%;
  left: 27%;
}

#cl3 {
  top: 48%;
  left: 27%;
}

#cl4 {
  top: 51.5%;
  left: 27%;
}

#cl5 {
  top: 55%;
  left: 27%;
}

#ct1 {
  top: 27%;
  left: 40%;
}

#ct2 {
  top: 27%;
  left: 44%;
}

#ct3 {
  top: 27%;
  left: 48%;
}

#ct4 {
  top: 27%;
  left: 52%;
}

#ct5 {
  top: 27%;
  left: 56%;
}

#cr1 {
  top: 41%;
  left: 70%;
}

#cr2 {
  top: 44.5%;
  left: 70%;
}

#cr3 {
  top: 48%;
  left: 70%;
}

#cr4 {
  top: 51.5%;
  left: 70%;
}

#cr5 {
  top: 55%;
  left: 70%;
}

#cb1 {
  top: 70%;
  left: 40%;
}

#cb2 {
  top: 70%;
  left: 44%;
}

#cb3 {
  top: 70%;
  left: 48%;
}

#cb4 {
  top: 70%;
  left: 52%;
}

#cb5 {
  top: 70%;
  left: 56%;
}

.hiddenCoin {
  visibility: hidden;
}

.arrow {
  /* Pfeile zum Verteilen der Münzen */
  position: absolute;
  left: 47%;
  height: 6%;
  visibility: hidden;
  /* img in den Vordergrund */
  z-index: 1;
}

#arrow-up {
  /* Pfeil Richtung Geldtopf in der Mitte */
  top: 62.5%;
}

#arrow-down {
  /* Pfeil Richtung Geldtopf unten */
  transform: rotate(180deg);
  top: 74.5%;
}

.otree-btn-next {
    all: initial;
    background-image: url({% static 'public_good_kids/confirm.png' %});
    background-repeat: no-repeat;
    background-position: center;
    background-size: 100%;
}

#confirmbutton {
  /* Button, der Auswahl bestätigt */
  width: 10%;
  height: 10%;
  position: absolute;
  bottom: 5%;
  right: 5%;
  visibility: hidden;
}

</style>
{% endblock %}



{% block content %}

<!--
<audio autoplay="autoplay">
 <source src={% static 'public_good_kids/jingle.mp3' %} type="audio/mpeg">
 Your browser does not support the audio element.
</audio>
-->

<div id ="container">
	<!-- Geldtöpfe -->
	<div class="partner hidden players" id="partnerLeft"></div>
	<div class="partner hidden players" id ="partnerTop"></div>
	<div class="partner hidden players" id ="partnerRight"></div>
	<div class="partner players" id ="partnerBottom"></div>

	<!-- Gemeinschaftstopf -->
	<div id="mainpot"></div>

	<!-- Spielerfiguren -->
	<img src={% static 'public_good_kids/figureyellow.png' %} class="figure figureLeft hidden players"/>
	<img src={% static 'public_good_kids/figuregreen.png' %} class="figure figureTop hidden players"/>
	<img src={% static 'public_good_kids/figurered.png' %} class="figure figureRight hidden players"/>
	<img onload="runInstructions()" src="{% static 'public_good_kids/figureblue.png' %}" class="figure figureBottom players"/>

  <!--Tierbilder -->
  <img src={% static imagepathleft %} class="animal animalLeft hidden"/>
  <img src={% static imagepathtop %} class="animal animalTop hidden"/>
  <img src={% static imagepathright %} class="animal animalRight hidden"/>
  <img src={% static imagepathbottom %} class="animal animalBottom hidden" id="ownAnimal"/>

	<!-- Münzen links -->
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cl1"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cl2"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cl3"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cl4"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cl5"/>

	<!-- Münzen oben -->
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="ct1"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="ct2"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="ct3"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="ct4"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="ct5"/>

	<!-- Münzen rechts -->
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cr1"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cr2"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cr3"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cr4"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidaway hidden" id="cr5"/>

	<!-- Münzen unten -->
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidden owncoins" id="cb1"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidden owncoins" id="cb2"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidden owncoins" id="cb3"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidden owncoins" id="cb4"/>
	<img src={% static 'public_good_kids/twocoins.png' %} class="coins hidden owncoins" id="cb5"/>

	<!-- Pfeile zum Münzen verteilen -->
	<img src={% static 'public_good_kids/arrow.png' %} class="arrow hidden" id="arrow-up"/>
	<img src={% static 'public_good_kids/arrow.png' %} class="arrow hidden" id="arrow-down"/>

	<!-- Bestätigungs-Button -->
  <button class="otree-btn-next btn next-button otree-next-button" id="confirmbutton"></button>
</div>



<!--
<button class="otree-btn-next btn next-button otree-next-button"></button>
-->

{% endblock %}



{% block scripts %}
<script type="text/javascript">
function runInstructions(){
  console.log("runInstructions");
  //Instruktion1a
  setTimeout(startAudioI1a, 900);
  setTimeout(showPlayers, 5000);
  setTimeout(showAnimal, 21000);
  setTimeout(showOtherAnimals, 27000);

  //call Instruktion1b
  // je nachdem ob in- oder outgroup unterscheiden sich die Audios um 10sek
  if ({{ groupdesign|json }} == 'in') {
    setTimeout(runInstructions1b, 42000);
  } else {
    setTimeout(runInstructions1b, 52000);
  }
}

function runInstructions1b(){
  //Instruktion1b
  var audio = new Audio('../../../../../static/public_good_kids/Instruktion1b_v1.mp3');
  audio.play();

  setTimeout(showCoins, 1500);
  setTimeout(highlightCoin, 4000);
  setTimeout(dehighlightCoin, 12000);

  // call Instruktion2
  setTimeout(runInstructions2, 41000);
}

function runInstructions2(){
  //Instruktion2
  var audio = new Audio('../../../../../static/public_good_kids/Instruktion2_v2.mp3');
  audio.play();

  setTimeout(highlightCoins, 3000);
  setTimeout(dehighlight, 10000);
  setTimeout(highlightPots, 12000);
  setTimeout(rotateOwn, 14000);
  setTimeout(rotateMain, 16500);
  setTimeout(dehighlight, 20000);
  setTimeout(contributeOneCoin, 39000);
  setTimeout(doubleCoin, 45000);
  setTimeout(othersContribute, 50000);
  setTimeout(doubleCoins, 56000);
  setTimeout(repositionAndDelete, 58000);
  setTimeout(contributeOneCoin, 60000);
  setTimeout(doubleCoin, 62000);
  setTimeout(distributeFour, 73000);
  setTimeout(repositionAndDelete, 76500);
  setTimeout(highlightPlayer, 78000);
  setTimeout(highlightOtherPlayers, 80000);

  //setTimeout(showConfirm, 12000);

  //call Instruktion3
  setTimeout(runInstructions3, 130000);
}

function runInstructions3(){
  var audio = new Audio('../../../../../static/public_good_kids/Instruktion3_v1.mp3');
  audio.play();

  setTimeout(runBeispiel3, 30500);
}

function runBeispiel3() {
  var audio = new Audio('../../../../../static/public_good_kids/Beispiel3.mp3');
  audio.play();
}


function startAudioI1a(){
  var audio = new Audio({{ instructions1a|json }});
  audio.play();
}


function showPlayers(){
  // shows pots, figures
  console.log("showPlayers");
  var i;
  var players = document.getElementsByClassName('players');
  for (i=0; i < players.length; i++) {
    players[i].classList.remove('hidden');
  }
}


function showAnimal(){
  // shows the own animal symbol
  console.log("showAnimals");

  document.getElementById('ownAnimal').classList.remove('hidden');
}

function showOtherAnimals(){
  // shows pots, figures
  console.log("showOtherAnimals");
  var i;
  var animals = document.getElementsByClassName('animal');
  for (i=0; i < animals.length; i++) {
    animals[i].classList.remove('hidden');
  }
}


function showCoins(){
  // shows coins
  console.log("showCoins");
  var j;
  var coins = document.getElementsByClassName('coins');
  for (j=0; j < coins.length; j++) {
    coins[j].classList.remove('hidden');
  }
}

function highlightCoin() {
  // highlights the middle coin pair
  console.log("highlightCoin");
  var elem = document.getElementById("cb3");
  elem.style.top = '35%';
  elem.style.left = '30%';
  elem.style.width = '40%';

  var el = document.querySelectorAll('*');
  for(var i=0;i<el.length;i++){
    if (el[i].id == 'cb3' || el[i].hasChildNodes()) {

    } else {
    el[i].style.opacity = '0.2';
    }
  }
}

function dehighlightCoin() {
  // removes highlighting of middle coin pair
  console.log("dehighlightCoin");
  var el = document.querySelectorAll('*');
  for(var i=0;i<el.length;i++){
    el[i].style.opacity = '1';
  }
  var elem = document.getElementById("cb3");
  elem.style.top = '70%';
  elem.style.left = '48%';
  elem.style.width = '4%';
}

function highlightCoins() {
  // highlights own 5 coin pairs
  console.log("highlightCoins");
  var el = document.querySelectorAll('*');
  for(var i=0;i<el.length;i++){
    if (el[i].classList.contains('owncoins') || el[i].hasChildNodes()) {

    } else {
    el[i].style.opacity = '0.2';
    }
  }
}

function dehighlight() {
  // changes opacity of all elements to normal (1)
  console.log("dehighlight");
  var el = document.querySelectorAll('*');
  for(var i=0;i<el.length;i++){
    el[i].style.opacity = '1';
  }
}

function highlightPots() {
  // highlights own pot and main pots
  console.log("highlightPots");
  var el = document.querySelectorAll('*');
  for(var i=0;i<el.length;i++){
    if (el[i].id == 'mainpot' || el[i].id == 'partnerBottom' || el[i].hasChildNodes()) {

    } else {
    el[i].style.opacity = '0.2';
    }
  }
}

function rotateMain() {
  console.log("rotateMain");
  var div = document.getElementById('mainpot');
  div.style.transition = 'all 2s';
  div.style.transform = 'rotate(360deg)';
}

function rotateOwn() {
  console.log("rotateOwn");
  var div = document.getElementById('partnerBottom');
  div.style.transition = 'all 2s';
  div.style.transform = 'rotate(360deg)';
}

function contributeOneCoin() {
  var cb3 = document.getElementById('cb3');
  cb3.style.top = '61%';
}

function doubleCoin() {
  var cb3 = document.getElementById('cb3');
  var coinClone = cb3.cloneNode();
  coinClone.classList.add('clone');
  coinClone.id = 'cb3clone';
  container.appendChild(coinClone);
  coinClone.style.top = '61%';
  coinClone.style.left = '48%';
  setTimeout(shift, 100);
  function shift() {
    coinClone.style.top = '58%';
  }
}

function othersContribute() {
  var cl3 = document.getElementById('cl3');
  cl3.style.left = '48%';
  cl3.style.top = '54%';
  var ct3 = document.getElementById('ct3');
  ct3.style.left = '48%';
  ct3.style.top = '39%';
  var cr3 = document.getElementById('cr3');
  cr3.style.left = '48%';
  cr3.style.top = '47%';
}

function doubleCoins() {
  var cl3 = document.getElementById('cl3');
  var ct3 = document.getElementById('ct3');
  var cr3 = document.getElementById('cr3');
  var coinClone2 = cl3.cloneNode();
  var coinClone3 = ct3.cloneNode();
  var coinClone4 = cr3.cloneNode();
  coinClone2.id = 'cl3clone';
  coinClone3.id = 'ct3clone';
  coinClone4.id = 'cr3clone';
  coinClone2.classList.add('clone');
  coinClone3.classList.add('clone');
  coinClone4.classList.add('clone');
  container.appendChild(coinClone2);
  container.appendChild(coinClone3);
  container.appendChild(coinClone4);
  coinClone2.style.top = '54%';
  coinClone3.style.top = '39%';
  coinClone4.style.top = '47%';
  coinClone2.style.left = '48%';
  coinClone2.style.left = '48%';
  coinClone2.style.left = '48%';
  setTimeout(shift, 100);
  function shift() {
    coinClone2.style.top = '51%';
    coinClone3.style.top = '36%';
    coinClone4.style.top = '44%';
  }
}

function repositionAndDelete() {
  var clones = document.getElementsByClassName('clone');
  var k = clones.length - 1;
  for (k; k >= 0; k--) {
    clones[k].parentNode.removeChild(clones[k]);
  }
  cb3.style.clipPath = 'none';
  cb3.style.left = '48%';
  cb3.style.top = '70%';
  cl3.style.left = '27%';
  cl3.style.top = '48%';
  ct3.style.left = '48%';
  ct3.style.top = '27%';
  cr3.style.left = '70%';
  cr3.style.top = '48%';
}

function distributeFour() {
  var cb3 = document.getElementById('cb3');
  var cb3clone = document.getElementById('cb3clone');
  var clone2 = cb3.cloneNode(false);
  clone2.classList.add('clone');
  var clone3 = cb3clone.cloneNode(false);
  clone3.classList.add('clone');
  var container = document.getElementById('container');
  container.appendChild(clone2);
  clone2.style.top = window.getComputedStyle(cb3,null).getPropertyValue('top');
  clone2.style.left = window.getComputedStyle(cb3,null).getPropertyValue('left');
  clone2.style.clipPath = "inset(0% 50% 0% 0%)";
  container.appendChild(clone3);
  clone3.style.top = window.getComputedStyle(cb3clone,null).getPropertyValue('top');
  clone3.style.left = window.getComputedStyle(cb3clone,null).getPropertyValue('left');
  clone3.style.clipPath = "inset(0% 50% 0% 0%)";

  // coin to left
  clone3.style.left = '10%';
  clone3.style.top = '48%';
  // coin to top
  cb3clone.style.left = '47%';
  cb3clone.style.top = '15%';
  cb3clone.style.clipPath = "inset(0% 00% 0% 50%)";
  // coin to right
  clone2.style.left = '90%';
  clone2.style.top = '48%';
  // coin to bottom
  cb3.style.left = '47%';
  cb3.style.top = '85%';
  cb3.style.clipPath = "inset(0% 0% 0% 50%)";
}

function highlightPlayer() {

}

function highlightOtherPlayers() {

}



function showConfirm() {
  // shows confirm button (green tick)
  console.log("showConfirm");
  document.getElementById('confirmbutton').style.visibility = 'visible';
}

</script>
{% endblock %}
